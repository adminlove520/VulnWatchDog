## 问题分析

**现象**：钉钉推送的内容格式与报告不一致，尤其是概要部分。

**根本原因**：
1. 在 `report_generator.py` 中，`write_to_markdown` 函数会对 `markdown` 内容进行一系列格式修复和清理
2. 而在 `webhook.py` 中，`parse_webhook_data` 函数只是简单地替换变量，没有对 `gpt.markdown` 应用相同的格式修复

**修复方案**：
1. 在 `webhook.py` 中，对 `gpt.markdown` 内容应用与 `write_to_markdown` 函数相同的格式修复逻辑
2. 确保钉钉推送的 `gpt.markdown` 内容经过与报告生成相同的格式处理

## 修复步骤

### 1. 提取格式修复逻辑为独立函数
- 在 `report_generator.py` 中，将 `write_to_markdown` 函数中的格式修复逻辑提取为独立的 `fix_markdown_format` 函数
- 确保该函数可以被其他模块调用

### 2. 在 webhook 处理中应用格式修复
- 在 `webhook.py` 的 `parse_webhook_data` 函数中，调用 `fix_markdown_format` 函数处理 `gpt.markdown` 内容
- 确保钉钉推送的内容格式与报告一致

### 3. 测试修复效果
- 运行程序，生成新的报告和钉钉推送
- 验证钉钉推送的内容格式与报告一致

## 预期效果

- 钉钉推送的内容格式与报告完全一致
- 概要部分的标题格式、换行和间距都符合预期
- 修复后的格式统一，提升用户体验

## 代码变更

1. **`report_generator.py`**：
   - 新增 `fix_markdown_format` 函数，提取格式修复逻辑

2. **`webhook.py`**：
   - 导入 `fix_markdown_format` 函数
   - 在 `parse_webhook_data` 中调用该函数处理 `gpt.markdown`

3. **`main.py`**：
   - 确保在调用 `send_webhook` 前，`gpt_results['markdown']` 已经过格式修复

## 风险评估

- 低风险：只是对内容格式进行修复，不影响功能逻辑
- 预期不会引入新的问题
- 修复后会提升用户体验，确保格式一致性