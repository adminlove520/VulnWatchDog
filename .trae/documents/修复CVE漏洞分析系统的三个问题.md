## 修复计划

### 1. 解决钉钉webhook发送失败问题
- **问题**：发送钉钉webhook时出现"Invalid control character"错误
- **解决方案**：在发送webhook之前，对所有数据进行清理，移除无效的控制字符
- **修改文件**：`libs/webhook.py`
- **修改内容**：
  - 在`parse_webhook_data`函数中添加控制字符清理逻辑
  - 确保所有数据在发送前都经过正确的清理
  - 使用正则表达式移除所有无效的控制字符

### 2. 调整相关文章结果的关键词
- **问题**：相关文章结果不符合预期，需要优先特定网站并过滤无关结果
- **解决方案**：修改搜索结果处理逻辑，添加网站优先级排序和结果过滤
- **修改文件**：`main.py`
- **修改内容**：
  - 添加网站优先级列表：先知社区、FreeBuf、securityvulnerability
  - 过滤掉标题中不包含CVE编号或相关信息的结果
  - 对搜索结果进行排序，优先显示高优先级网站的结果

### 3. 优化fastgpt提示词
- **问题**：生成的报告格式不正确，特别是概要部分
- **解决方案**：优化fastgpt_cve_prompt.txt文件，确保生成的报告格式符合要求
- **修改文件**：`fastgpt_cve_prompt.txt`
- **修改内容**：
  - 明确要求生成的markdown格式正确
  - 确保各个部分（漏洞概述、有效性分析、投毒风险分析、利用方式、代码分析）之间有正确的换行和标题
  - 确保生成的内容可以直接用于报告
  - 移除不必要的格式要求，简化输出格式

### 4. 验证修复效果
- **运行程序**：使用`python main.py --limit 1`命令测试修复效果
- **检查报告**：查看生成的markdown报告格式是否正确
- **检查推送**：查看钉钉推送是否成功发送
- **检查相关文章**：查看相关文章部分是否符合预期

### 5. 预期效果
- 钉钉webhook发送成功，不再出现"Invalid control character"错误
- 相关文章结果优先显示特定网站的内容，过滤掉无关结果
- 生成的报告格式正确，特别是概要部分
- 程序能正常运行，处理CVE信息并生成分析报告

### 6. 风险评估
- 修复仅涉及代码逻辑和提示词，不影响核心功能
- 修改简单，风险较低
- 验证过程简单，容易确认修复效果