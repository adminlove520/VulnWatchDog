# VulnWatchdog项目优化计划

## 1. 修复钉钉推送结果格式问题
- **问题**：钉钉推送的markdown内容中包含未替换的变量（如`{gpt.cve_id}`）
- **原因**：`parse_webhook_data`函数查找的是`{key}`格式的变量，但模板中使用的是`${key}`格式
- **解决方案**：修改`parse_webhook_data`函数，使其支持`${key}`格式的变量替换

## 2. 添加FastGPT支持
- **问题**：当前只支持Gemini API，需要添加FastGPT支持
- **解决方案**：
  - 修改`config.py`，添加FastGPT相关配置和provider开关
  - 修改`gpt_utils.py`，添加FastGPT API调用逻辑
  - 实现provider切换机制，根据配置选择使用Gemini或FastGPT

## 3. 修复每日报告更新问题
- **问题**：data/markdown的每日报告没有更新
- **解决方案**：
  - 检查每日报告生成逻辑，确保它能正确执行
  - 添加定时任务，定期生成每日报告
  - 确保报告生成后能正确保存到指定目录

## 4. 修复每周漏洞报告功能
- **问题**：data/WeeklyReport每周漏洞报告功能有问题
- **解决方案**：
  - 修复`generate_weekly_report`函数中的日期计算逻辑
  - 修复查询条件，确保能正确获取本周的漏洞数据
  - 修复报告内容生成逻辑，确保所有字段都能正确填充

## 5. 其他优化点
- **代码结构优化**：调整代码结构，使逻辑更清晰
- **配置管理优化**：将硬编码的配置移到配置文件中
- **错误处理优化**：完善错误处理机制，提高系统稳定性
- **日志记录优化**：增强日志记录，便于调试和监控

## 6. 实施步骤
1. 修复钉钉推送格式问题
2. 添加FastGPT支持
3. 修复每日报告更新问题
4. 修复每周报告功能
5. 进行其他优化
6. 测试所有功能，确保正常运行

## 7. 预期效果
- 钉钉推送能正确显示所有信息，没有未替换的变量
- 可以通过配置切换使用Gemini或FastGPT进行漏洞分析
- 每日报告能按时更新
- 每周报告能正确生成，包含完整的漏洞信息
- 系统整体性能和稳定性得到提升